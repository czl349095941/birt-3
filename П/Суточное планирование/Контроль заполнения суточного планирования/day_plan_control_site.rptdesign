<?xml version="1.0" encoding="UTF-8"?>
<report xmlns="http://www.eclipse.org/birt/2005/design" version="3.2.17" id="1">
    <property name="createdBy">Eclipse BIRT Designer Version 2.3.2.r232_20090202 Build &lt;2.3.2.v20090218-0730></property>
    <property name="units">in</property>
    <text-property name="title">Суточный план</text-property>
    <property name="comments">IBM Confidential

OCO Source Materials

5724-M19

(C) COPYRIGHT IBM CORP. 2006

The source code for this program is not published or otherwise
divested of its trade secrets, irrespective of what has been
deposited with the U.S. Copyright Office.</property>
    <html-property name="description">This template will create a report with one or more groups, each having identical data fields, and contains three styles of charts.</html-property>
    <method name="initialize"><![CDATA[importPackage(Packages.com.ibm.tivoli.maximo.report.script);

mxReportScriptContext = MXReportScriptContext.initialize(reportContext);


mxReportScriptContext = MXReportScriptContext.initialize(reportContext);
mxReportScriptContext.setDefaultLogLevel("DEBUG");
mxReportScriptContext.setDefaultLogFile("c:/temp/tetttt.txt");

params["brig"] = params["brig"].replace("=","");

if(params["date1"]=='' || params["date1"] == null || params["date1"] == '""' )
params["date1"] = "sysdate"; else {params["date1"] = "'" + params["date1"]+ "' ";}]]></method>
    <method name="afterFactory"><![CDATA[MXReportScriptContext.close();]]></method>
    <property name="theme">MaximoSystemLibrary.maximoTheme</property>
    <text-property name="displayName">Tivoli Maximo Grouped Chart Template</text-property>
    <list-property name="libraries">
        <structure>
            <property name="fileName">MaximoSystemLibrary.rptlibrary</property>
            <property name="namespace">MaximoSystemLibrary</property>
        </structure>
    </list-property>
    <parameters>
        <scalar-parameter name="where" id="25">
            <property name="valueType">static</property>
            <property name="dataType">string</property>
            <property name="isRequired">false</property>
            <property name="controlType">text-box</property>
            <property name="defaultValue">1=1</property>
            <structure name="format">
                <property name="category">Unformatted</property>
            </structure>
        </scalar-parameter>
        <scalar-parameter name="appname" id="240">
            <property name="valueType">static</property>
            <property name="dataType">string</property>
            <property name="isRequired">false</property>
            <property name="controlType">text-box</property>
            <structure name="format">
                <property name="category">Unformatted</property>
            </structure>
        </scalar-parameter>
        <scalar-parameter name="mroSite" id="7964">
            <property name="valueType">static</property>
            <property name="dataType">integer</property>
            <property name="paramType">simple</property>
            <text-property name="promptText">Дорога</text-property>
            <property name="isRequired">true</property>
            <property name="controlType">text-box</property>
            <property name="distinct">true</property>
            <structure name="format">
                <property name="category">Unformatted</property>
            </structure>
        </scalar-parameter>
        <scalar-parameter name="date1" id="13304">
            <property name="valueType">static</property>
            <property name="dataType">string</property>
            <property name="paramType">simple</property>
            <text-property name="promptText">Дата</text-property>
            <property name="isRequired">false</property>
            <property name="controlType">text-box</property>
            <property name="distinct">true</property>
            <structure name="format">
                <property name="category">Unformatted</property>
            </structure>
        </scalar-parameter>
        <scalar-parameter name="brig" id="17062">
            <property name="valueType">static</property>
            <property name="dataType">string</property>
            <property name="paramType">simple</property>
            <text-property name="promptText">Бригада</text-property>
            <property name="isRequired">true</property>
            <property name="controlType">text-box</property>
            <property name="distinct">true</property>
            <structure name="format">
                <property name="category">Unformatted</property>
            </structure>
        </scalar-parameter>
    </parameters>
    <data-sources>
        <script-data-source name="maximoDataSource" id="64" extends="MaximoSystemLibrary.maximoDataSource"/>
    </data-sources>
    <data-sets>
        <script-data-set name="11" id="7971">
            <list-property name="resultSetHints">
                <structure>
                    <property name="position">1</property>
                    <property name="name">DDAY</property>
                    <property name="dataType">integer</property>
                </structure>
                <structure>
                    <property name="position">2</property>
                    <property name="name">PRED_ID</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">3</property>
                    <property name="name">PRED_D</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">4</property>
                    <property name="name">CNT</property>
                    <property name="dataType">string</property>
                </structure>
            </list-property>
            <list-property name="columnHints">
                <structure>
                    <property name="columnName">MEASURE</property>
                </structure>
                <structure>
                    <property name="columnName">PLAN_LABOR_HOUR</property>
                </structure>
                <structure>
                    <property name="columnName">NORM_PLAN_LH</property>
                </structure>
                <structure>
                    <property name="columnName">LABORCODE</property>
                </structure>
                <structure>
                    <property name="columnName">SIGNAL</property>
                </structure>
                <structure>
                    <property name="columnName">TYPEWO</property>
                </structure>
                <structure>
                    <property name="columnName">STATUS</property>
                </structure>
                <structure>
                    <property name="columnName">DDAY</property>
                </structure>
                <structure>
                    <property name="columnName">PRED_ID</property>
                </structure>
                <structure>
                    <property name="columnName">PRED_D</property>
                </structure>
                <structure>
                    <property name="columnName">CNT</property>
                </structure>
            </list-property>
            <structure name="cachedMetaData">
                <list-property name="resultSet">
                    <structure>
                        <property name="position">1</property>
                        <property name="name">DDAY</property>
                        <property name="dataType">integer</property>
                    </structure>
                    <structure>
                        <property name="position">2</property>
                        <property name="name">PRED_ID</property>
                        <property name="dataType">string</property>
                    </structure>
                    <structure>
                        <property name="position">3</property>
                        <property name="name">PRED_D</property>
                        <property name="dataType">string</property>
                    </structure>
                    <structure>
                        <property name="position">4</property>
                        <property name="name">CNT</property>
                        <property name="dataType">string</property>
                    </structure>
                </list-property>
            </structure>
            <property name="dataSource">maximoDataSource</property>
            <method name="open"><![CDATA[maximoDataSet = MXReportDataSetProvider.create(this.getDataSource().getName(), this.getName());
maximoDataSet.open();

var sqlText = new String();

sqlText = "" 
 +" with DDAY as "
 +" ( "
 +" select 1 dday from dual union all "
 +" select 2 dday from dual union all "
 +" select 3 dday from dual union all "
 +" select 4 dday from dual union all "
 +" select 5 dday from dual union all "
 +" select 6 dday from dual union all "
 +" select 7 dday from dual union all "
 +" select 8 dday from dual union all "
 +" select 9 dday from dual union all "
 +" select 10 dday from dual union all "
 +" select 11 dday from dual union all "
 +" select 12 dday from dual union all "
 +" select 13 dday from dual union all "
 +" select 14 dday from dual union all "
 +" select 15 dday from dual union all "
 +" select 16 dday from dual union all "
 +" select 17 dday from dual union all "
 +" select 18 dday from dual union all "
 +" select 19 dday from dual union all "
 +" select 20 dday from dual union all "
 +" select 21 dday from dual union all "
 +" select 22 dday from dual union all "
 +" select 23 dday from dual union all "
 +" select 24 dday from dual union all "
 +" select 25 dday from dual union all "
 +" select 26 dday from dual union all "
 +" select 27 dday from dual union all "
 +" select 28 dday from dual union all "
 +" select 29 dday from dual union all "
 +" select 30 dday from dual union all "
 +" select 31 DDAY from DUAL "
 +" ) "
 +" SELECT  DDAY.DDAY, "
 +"         PORD.PRED_ID, "
 +"         nvl(PREDS.DESCRIPTION, -1) PRED_D, "
 +"         SUM(CASE WHEN PORD.PLANORDNUM IS NOT NULL THEN 1 ELSE 0 END) cnt "
 +" FROM    DDAY "
 +"         LEFT JOIN MAXIMO.PLAN_ORD PORD "
 +"                 ON      DDAY.DDAY                              = extract (DAY FROM PLAN_BEG_DATE) "
 +"                         AND PORD.SITEID                        = '24' "
 +"                         AND extract (YEAR FROM PLAN_BEG_DATE)  = '2014' "
 +"                         AND extract (MONTH FROM PLAN_BEG_DATE) = '6' "
 +"                         AND pord.h                             = 800 "
 +"         LEFT JOIN maximo.preds "
 +"                 ON      pord.siteid      = preds.siteid "
 +"                         AND pord.pred_id = preds.location "
 +" GROUP BY dday.dday, "
 +"         PORD.PRED_ID, "
 +"         nvl(PREDS.DESCRIPTION, -1) "
;


maximoDataSet.setQuery(sqlText);]]></method>
            <method name="fetch"><![CDATA[if (!maximoDataSet.fetch())
	return (false);

row["DDAY"] = maximoDataSet.getString("DDAY");
row["PRED_ID"] = maximoDataSet.getString("PRED_ID");
row["PRED_D"] = maximoDataSet.getString("PRED_D");
row["CNT"] = maximoDataSet.getString("CNT");



	
return (true);]]></method>
        </script-data-set>
    </data-sets>
    <cubes>
        <tabular-cube name="Data Cube" id="17811">
            <property name="dimensions">
                <tabular-dimension name="Group" id="17812">
                    <property name="defaultHierarchy">NewTabularHierarchy</property>
                    <property name="hierarchies">
                        <tabular-hierarchy name="NewTabularHierarchy" id="17813">
                            <property name="levels">
                                <tabular-level name="PRED_D" id="17814">
                                    <property name="dataType">string</property>
                                    <property name="columnName">PRED_D</property>
                                </tabular-level>
                            </property>
                        </tabular-hierarchy>
                    </property>
                </tabular-dimension>
                <tabular-dimension name="Group1" id="17815">
                    <property name="defaultHierarchy">NewTabularHierarchy1</property>
                    <property name="hierarchies">
                        <tabular-hierarchy name="NewTabularHierarchy1" id="17816">
                            <property name="levels">
                                <tabular-level name="DDAY" id="17817">
                                    <property name="dataType">integer</property>
                                    <property name="levelType">dynamic</property>
                                    <property name="columnName">DDAY</property>
                                </tabular-level>
                            </property>
                        </tabular-hierarchy>
                    </property>
                </tabular-dimension>
            </property>
            <property name="measureGroups">
                <tabular-measure-group name="Summary Field" id="17818">
                    <property name="measures">
                        <tabular-measure name="CNT" id="17819">
                            <expression name="measureExpression">dataSetRow["CNT"]</expression>
                            <property name="dataType">string</property>
                        </tabular-measure>
                    </property>
                </tabular-measure-group>
            </property>
            <property name="dataSet">11</property>
        </tabular-cube>
    </cubes>
    <page-setup>
        <simple-master-page name="maximoLandscape" id="47" extends="MaximoSystemLibrary.maximoLandscape">
            <property name="type">a4</property>
            <property name="leftMargin">0.5in</property>
            <overridden-values>
                <ref-entry baseId="304" name="NewGrid2" id="304"/>
                <ref-entry baseId="305" id="305"/>
                <ref-entry baseId="306" id="306"/>
                <ref-entry baseId="307" id="307"/>
                <ref-entry baseId="308" id="308">
                    <property name="canShrink">false</property>
                </ref-entry>
                <ref-entry baseId="340" name="NewImage1" id="340">
                    <property name="source">file</property>
                    <expression name="uri">"IBM_logo_Black.gif"</expression>
                    <property name="height">1px</property>
                    <property name="width">3px</property>
                </ref-entry>
                <ref-entry baseId="309" id="309"/>
                <ref-entry baseId="310" name="NewImage" id="310">
                    <property name="height">1px</property>
                    <property name="width">3px</property>
                </ref-entry>
                <ref-entry baseId="322" name="NewGrid" id="322"/>
                <ref-entry baseId="323" id="323"/>
                <ref-entry baseId="324" id="324"/>
                <ref-entry baseId="325" id="325"/>
                <ref-entry baseId="326" id="326"/>
                <ref-entry baseId="328" name="NewText" id="328">
                    <list-property name="visibility">
                        <structure>
                            <property name="format">all</property>
                            <expression name="valueExpr">true</expression>
                        </structure>
                    </list-property>
                </ref-entry>
                <ref-entry baseId="327" id="327"/>
                <ref-entry baseId="329" name="NewGrid1" id="329"/>
                <ref-entry baseId="330" id="330"/>
                <ref-entry baseId="331" id="331"/>
                <ref-entry baseId="332" id="332"/>
                <ref-entry baseId="333" id="333"/>
                <ref-entry baseId="334" id="334"/>
                <ref-entry baseId="335" name="NewAutoText" id="335">
                    <list-property name="visibility">
                        <structure>
                            <property name="format">all</property>
                            <expression name="valueExpr">true</expression>
                        </structure>
                    </list-property>
                </ref-entry>
                <ref-entry baseId="336" id="336"/>
                <ref-entry baseId="337" name="NewText1" id="337">
                    <list-property name="visibility">
                        <structure>
                            <property name="format">all</property>
                            <expression name="valueExpr">true</expression>
                        </structure>
                    </list-property>
                </ref-entry>
                <ref-entry baseId="338" id="338"/>
                <ref-entry baseId="339" name="NewAutoText1" id="339">
                    <list-property name="visibility">
                        <structure>
                            <property name="format">all</property>
                            <expression name="valueExpr">true</expression>
                        </structure>
                    </list-property>
                </ref-entry>
            </overridden-values>
        </simple-master-page>
    </page-setup>
    <body>
        <label id="17370">
            <property name="fontSize">medium</property>
            <property name="fontWeight">bold</property>
            <property name="textAlign">center</property>
            <text-property name="text">Суточный план</text-property>
        </label>
        <label id="17718"/>
        <extended-item extensionName="Crosstab" extensionVersion="2.3.0" id="17837">
            <property name="measures">
                <extended-item extensionName="MeasureView" id="17848">
                    <property name="measure">CNT</property>
                    <property name="detail">
                        <extended-item extensionName="AggregationCell" id="17849">
                            <property name="aggregationOnRow">Group/PRED_D</property>
                            <property name="aggregationOnColumn">Group1/DDAY</property>
                            <property name="borderTopStyle">solid</property>
                            <property name="borderTopWidth">thin</property>
                            <property name="borderTopColor">#000000</property>
                            <property name="borderLeftStyle">solid</property>
                            <property name="borderLeftWidth">thin</property>
                            <property name="borderLeftColor">#000000</property>
                            <property name="borderBottomStyle">solid</property>
                            <property name="borderBottomWidth">thin</property>
                            <property name="borderBottomColor">#000000</property>
                            <property name="borderRightStyle">solid</property>
                            <property name="borderRightWidth">thin</property>
                            <property name="borderRightColor">#000000</property>
                            <property name="content">
                                <data id="17850">
                                    <property name="textAlign">center</property>
                                    <list-property name="visibility">
                                        <structure>
                                            <property name="format">all</property>
                                            <expression name="valueExpr">data["PRED_D"] == -1</expression>
                                        </structure>
                                    </list-property>
                                    <property name="resultSetColumn">CNT_Group/PRED_D_Group1/DDAY</property>
                                </data>
                            </property>
                        </extended-item>
                    </property>
                    <property name="header">
                        <extended-item extensionName="CrosstabCell" id="17851"/>
                    </property>
                </extended-item>
            </property>
            <property name="rows">
                <extended-item extensionName="CrosstabView" id="17839">
                    <property name="views">
                        <extended-item extensionName="DimensionView" id="17840">
                            <property name="dimension">Group</property>
                            <property name="levels">
                                <extended-item extensionName="LevelView" name="NewLevel View" id="17841">
                                    <property name="level">Group/PRED_D</property>
                                    <property name="sort">
                                        <sort-element>
                                            <expression name="key">data["data_sort"]</expression>
                                            <property name="direction">asc</property>
                                        </sort-element>
                                    </property>
                                    <property name="member">
                                        <extended-item extensionName="CrosstabCell" id="17842">
                                            <property name="content">
                                                <data name="PRED_D" id="17843">
                                                    <property name="textAlign">left</property>
                                                    <list-property name="visibility">
                                                        <structure>
                                                            <property name="format">all</property>
                                                            <expression name="valueExpr">data["PRED_D"] == -1</expression>
                                                        </structure>
                                                    </list-property>
                                                    <property name="resultSetColumn">PRED_D</property>
                                                </data>
                                                <data id="17910">
                                                    <property name="resultSetColumn">data_sort</property>
                                                </data>
                                            </property>
                                        </extended-item>
                                    </property>
                                </extended-item>
                            </property>
                        </extended-item>
                    </property>
                </extended-item>
            </property>
            <property name="columns">
                <extended-item extensionName="CrosstabView" id="17853">
                    <property name="views">
                        <extended-item extensionName="DimensionView" id="17844">
                            <property name="dimension">Group1</property>
                            <property name="levels">
                                <extended-item extensionName="LevelView" name="NewLevel View1" id="17845">
                                    <property name="level">Group1/DDAY</property>
                                    <property name="member">
                                        <extended-item extensionName="CrosstabCell" id="17846">
                                            <property name="content">
                                                <data name="DDAY" id="17847">
                                                    <property name="resultSetColumn">DDAY</property>
                                                </data>
                                            </property>
                                        </extended-item>
                                    </property>
                                </extended-item>
                            </property>
                        </extended-item>
                    </property>
                </extended-item>
            </property>
            <property name="header">
                <extended-item extensionName="CrosstabCell" id="17838"/>
            </property>
            <property name="borderTopStyle">solid</property>
            <property name="borderTopWidth">thin</property>
            <property name="borderTopColor">#000000</property>
            <property name="borderLeftStyle">solid</property>
            <property name="borderLeftWidth">thin</property>
            <property name="borderLeftColor">#000000</property>
            <property name="borderBottomStyle">solid</property>
            <property name="borderBottomWidth">thin</property>
            <property name="borderBottomColor">#000000</property>
            <property name="borderRightStyle">solid</property>
            <property name="borderRightWidth">thin</property>
            <property name="borderRightColor">#000000</property>
            <property name="cube">Data Cube</property>
            <list-property name="boundDataColumns">
                <structure>
                    <property name="name">PRED_D</property>
                    <expression name="expression">dimension["Group"]["PRED_D"]</expression>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="name">DDAY</property>
                    <expression name="expression">dimension["Group1"]["DDAY"]</expression>
                    <property name="dataType">integer</property>
                </structure>
                <structure>
                    <property name="name">CNT_Group1/DDAY</property>
                    <expression name="expression">measure["CNT"]</expression>
                    <property name="dataType">string</property>
                    <simple-property-list name="aggregateOn">
                        <value>Group1/DDAY</value>
                    </simple-property-list>
                    <property name="aggregateFunction">sum</property>
                </structure>
                <structure>
                    <property name="name">CNT_Group/PRED_D</property>
                    <expression name="expression">measure["CNT"]</expression>
                    <property name="dataType">string</property>
                    <simple-property-list name="aggregateOn">
                        <value>Group/PRED_D</value>
                    </simple-property-list>
                    <property name="aggregateFunction">sum</property>
                </structure>
                <structure>
                    <property name="name">CNT_Group/PRED_D_Group1/DDAY</property>
                    <expression name="expression">measure["CNT"]</expression>
                    <property name="dataType">string</property>
                    <simple-property-list name="aggregateOn">
                        <value>Group/PRED_D</value>
                        <value>Group1/DDAY</value>
                    </simple-property-list>
                    <property name="aggregateFunction">sum</property>
                </structure>
                <structure>
                    <property name="name">data_sort</property>
                    <expression name="expression">data["PRED_D"]
//.replace(/^ПЧ-/, "")
.replace(/\D*$/,"")
//*1</expression>
                    <property name="dataType">integer</property>
                </structure>
            </list-property>
        </extended-item>
    </body>
</report>
